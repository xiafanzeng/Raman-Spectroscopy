<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
<!--  <link rel="stylesheet" href="../static/css/bootstrap.css">-->
  <link href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script src="https://cdn.staticfile.org/echarts/4.3.0/echarts.min.js"></script>
  <script src="../static/js/jquery-3.3.1.js"></script>
  <script src="../static/js/bootstrap.js"></script>
  <title>query spectrum</title>
  <style>
     body{
      font-family: "Microsoft YaHei", Arial, sans-serif;
    }
     .page-header{
      margin-bottom: 10px;
    }
     h1 {
       padding-left: 10px;
       color: #b6bb99;
        font-size: 46px;
      }
     h1 span{
       color: #0868a3;
     }
     h1 small{
       color: #747474;
     }

    .clearfix::after,.clearfix::before{
      content: '';
      display: table;
      clear: both;
    }
    .navbar-nav li a{
      margin: auto 50px;
      font-size: 16px;
    }
    .navbar-default .navbar-nav>li>a {
    color: #fff;
}
    .navbar-nav li:hover{
      background-color: darkgray;
    }
    .navbar-default{
      background-color: #337ab7;
    }


    .glyphicon-search{
      font-size: 20px;

    }
    p{
      font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
      font-size: 20px;
    }


    .glyphicon-trash, .glyphicon-refresh,.glyphicon-save{
      font-size: 20px;

    }
    #delete-btn{
      float: right;
    }
    #update-btn{
     margin: auto 13px;
    }
    .dropdown-menu {

    min-width: 300px;
}
    .dropdown-toggle{
       margin: auto 4px;
      font-size: 15px;
    }


  </style>
</head>
<body>
<!--页面头部-->
<div class="page-header">
  <h1 ><span >Sit</span>Raman System <small>上海应用技术大学拉曼光谱分析系统</small></h1>
</div>
<!--导航栏-->
<nav class="navbar navbar-default">
  <div class="container-fluid first div">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/" style=" color: white;margin-left: 30px">首页</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li class="meta"><a  href="../static/create.html" >上传光谱数据 </a></li>
        <li class="meta"><a href="../static/query.html" >查询光谱信息</a></li>
        <li class="meta"><a href="../static/classification.html" >光谱数据分类</a></li>
        <li class="dropdown meta">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false" >了解更多关于拉曼光谱<span class="caret"></span></a>
          <ul class="dropdown-menu" style="background-color: #337ab7">
            <li ><a href="#">拉曼光谱原理</a></li>
            <li ><a href="#">拉曼光谱应用</a></li>
            <li><a href="#">Something else here</a></li>

          </ul>
        </li>
        <li class="meta"><a href="../static/contact.html" >联系我们</a></li>

      </ul>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      <p><b>请选择查询方式  <span class="glyphicon glyphicon-search"></span>：</b></p>

      <div class="query_data">
        <form name='query' method="post" action="/spectrum/query">
          <!--                <input type="text" name = "query_sort" placeholder="id/CAS/name">-->
          <input type="radio" name="query_sort" value="id" placeholder="id"> Id
          <input type="radio" name="query_sort" value="CAS" placeholder="cas"> CAS

          <input type="radio" name="query_sort" value="name" placeholder="name"> Name
          <br>
          <input type="text" style=" width: 300px" name="query_number" placeholder="Please enter spectrum Id\ Name \ CAS number">
          <!--<input type="submit" value="查询" class="btn-primary">-->
          <button type="submit" class="btn-primary btn btn-primary">查询</button>
        </form>

        <div id="infoshow" class="page-wrapper" style="text-align: right" >
       <a  style="margin-left: 4px" name="downloadbtn" class="btn btn-primary pull-right" href="downloadfile">下载此光谱数据
       <span class="glyphicon glyphicon-save"></span>
       </a>
        <button type="submit" class="btn btn-primary" id="delete-btn" style="float:right;">
        删除此光谱数据 <span class="glyphicon glyphicon-trash"></span>
        </button>
        <div class="btn-group">
  <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    更新此光谱 <span class=" glyphicon glyphicon-refresh "></span>
  </button>
  <ul class="dropdown-menu">
      <input type="file" class="btn " id="file-loader" multiple style="float:right; margin-left: 4px">
         <button type="submit" class="btn btn-primary" id="update-btn">
        点击更新
         </button>
  </ul>
        </div>

      <iframe src="../static/check.html" name="i" id="urlIframe" width="100%" height="100%"
          frameborder="0" scrolling="no" marginheight="0" marginwidth="0"
          onload="reinitIframe()">

      </iframe>

</div>


      </div>

    </div><!-- /.col-lg-6 -->
    <!--<div class="col-md-12">-->
      <!--<p><b>查询信息如下:</b></p>-->
      <!--<div id="infoshow" class="page-wrapper" style="text-align: right">-->
       <!--<a  style="margin-left: 4px" name="downloadbtn" class="btn btn-primary pull-right" href="downloadfile">下载此光谱数据-->
       <!--<span class="glyphicon glyphicon-save"></span>-->
       <!--</a>-->
        <!--<button type="submit" class="btn btn-primary" id="delete-btn">-->
        <!--删除此光谱数据 <span class="glyphicon glyphicon-trash"></span>-->
        <!--</button>-->
        <!--<input type="file" class="btn " id="file-loader" multiple style="float:right; margin-left: 4px">-->
         <!--<button type="submit" class="btn btn-primary" id="update-btn">-->
        <!--选择文件更新此光谱数据 <span class="glyphicon glyphicon-refresh"> :</span>-->
         <!--</button>-->

      <!--<iframe src="../static/check.html" name="i" id="urlIframe" width="100%" height="100%"-->
          <!--frameborder="0" scrolling="no" marginheight="0" marginwidth="0"-->
          <!--onload="reinitIframe()">-->

      <!--</iframe>-->

<!--</div>-->
      <!--</div>-->


    <!--<div class="col-md-12" >-->
      <!--<div id="infoshow" class="page-wrapper" style="text-align: right">-->
       <!--<a  style="margin-left: 4px" name="downloadbtn" class="btn btn-primary pull-right" href="downloadfile">下载此光谱数据-->
       <!--<span class="glyphicon glyphicon-save"></span>-->
       <!--</a>-->
        <!--<button type="submit" class="btn btn-primary" id="delete-btn">-->
        <!--删除此光谱数据 <span class="glyphicon glyphicon-trash"></span>-->
        <!--</button>-->
        <!--<div class="btn-group">-->
  <!--<button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">-->
    <!--更新此光谱 <span class=" glyphicon glyphicon-refresh "></span>-->
  <!--</button>-->
  <!--<ul class="dropdown-menu">-->
      <!--<input type="file" class="btn " id="file-loader" multiple style="float:right; margin-left: 4px">-->
         <!--<button type="submit" class="btn btn-primary" id="update-btn">-->
        <!--点击更新-->
         <!--</button>-->
  <!--</ul>-->
        <!--</div>-->

      <!--<iframe src="../static/check.html" name="i" id="urlIframe" width="100%" height="100%"-->
          <!--frameborder="0" scrolling="no" marginheight="0" marginwidth="0"-->
          <!--onload="reinitIframe()">-->

      <!--</iframe>-->

<!--</div>-->
      <!--</div>-->


  </div><!-- /.row -->

</div>
<script>
  var spectrums = [];
  var fileLoader = document.getElementById("file-loader");
  fileLoader.addEventListener("change", (event) => {
    const files = event.target.files;
    for (var i = 0, f; f = files[i]; i++) {
      var reader = new FileReader();
      reader.onload = (function (theFile) {
        return function (e) {
          var span = document.createElement('span');
          let spectrum = e.target.result
          // span.innerHTML = ['<img class="thumb" src="', e.target.result,
          //                 '" title="', escape(theFile.name), '"/>'].join('');
          spectrum = loadSpectrum(spectrum)
          spectrums.push(spectrum)
          console.log(spectrum);
          const option = {
            title: {
              text: spectrums[0].name+'的原始拉曼光谱图像为'
            },
            tooltip: {},
            legend: {
            },
            xAxis: {
              // type:'value',

              data: spectrums[0].data.x
            },
            yAxis: {
              data: spectrums[0].data.y

            },
            series: [{
              type: 'line',
              data: spectrums[0].data.y
            }]
          }
          drawChart(option)
        };
      })(f);
      reader.readAsText(f);
    }

  })

   <!--update点击事件-->
  var update = document.getElementById('update-btn');
  update.addEventListener('click', e => {
    for (let spectrum of spectrums) {
      console.log(spectrum);
      if (window.confirm("update spectrum ?")) {
        axios.put('/spectrum', spectrum);
        return true;
      } else {
        return false;
      }
    }
  });


  <!--delete点击事件-->
  var delete_b = document.getElementById('delete-btn');
  delete_b.addEventListener('click', e => {
    if (window.confirm("delete spectrum ?")) {
      axios.delete('/spectrum');
      return true;
    } else {
      return false;
    }
  });




  function loadSpectrum(spectrum) {
    const lines = spectrum.split('\n');
    const res = {};
    const x = [], y = [];
    for (let line of lines) {
      if (line.includes('#')) {
        // strip #
        line = line.replace(/#/g, '');

        // key value
        for (let sep of [':', '=']) {
          if (line.includes(sep)) {
            let prop = line.split(sep);
            if (prop.length !== 2) continue;
            if (!prop[0] || !prop[1]) continue;
            let key = prop[0].trim().replace(' ', '_').toLowerCase();
            let val = prop[1].trim();
            if (key.includes('name')) key = 'name';
            // if(key in ['name', 'cas', 'description', 'measured_chemistry', 'ideal_chemistry', 'orientation', 'status', 'pin_id', 'source','locality'])
            res[key] = val;
            break;
          }
        }
      } else {
        // let isDigit = x => /^\d+$/g.test(x.trim());

        for (let sep of [' ', ',']) {
          let xy = line.split(sep);
          if (xy.length !== 2) continue;
          // if (isDigit(xy[0]) || isDigit(xy[1])) continue;
          x.push(+xy[0].trim());
          y.push(+xy[1].trim());
        }
        res.data = {x, y}
      }


    }
    return res
  }

  // // graph
  // var myChart = echarts.init(document.getElementById('echarts'));
  //
  // // var
  // // myChart.setOption(option);
  // function drawChart(option) {
  //   myChart.setOption(option);
  // }
  //query
  function reinitIframe() {
    var iframe = document.getElementById("urlIframe");
    try {
      var bHeight = iframe.contentWindow.document.body.scrollHeight;
      iframe.height = bHeight;
    } catch (ex) {
    }
  }
</script>

</body>
</html>
